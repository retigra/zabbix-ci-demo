zabbix_export:
  version: '7.2'
  template_groups:
  - uuid: a571c0d144b14fd4a87a9d9b2aa9fcd6
    name: Templates/Applications
  templates:
  - uuid: b6027e374e424481951ca2256099515c
    template: Nutanix Cluster Prism Element by HTTP
    name: Nutanix Cluster Prism Element by HTTP
    description: |
      Prism Element: It is a service already built into the platform for every Nutanix cluster deployed. It provides the ability to fully configure, manage, and monitor Nutanix clusters running any hypervisors, however, It only manages the cluster it is part of.

      This template is designed for the effortless deployment of Nutanix Cluster Prism Element monitoring and doesn't require any external scripts.

      This template can be used in discovery, as well as manually linked to a host - to do so, attach it to the host and manually set the value of the '{$NUTANIX.CLUSTER.UUID}' macro.

      More details can be found in the official documentation:
        - on retrieving UUIDs: https://www.nutanixbible.com/19b-cli.html
        - on the Nutanix Prism Element REST API: https://www.nutanix.dev/api_reference/apis/prism_v2.html
        - on differences between Nutanix API versions: https://www.nutanix.dev/api-versions/

      Generated by official Zabbix template tool "Templator"
    vendor:
      name: Zabbix
      version: 7.2-1
    groups:
    - name: Templates/Applications
    items:
    - uuid: 3761d4da912749c7a84f11a5cfbcf761
      name: Get alert
      type: SCRIPT
      key: nutanix.cluster.alert.get
      history: '0'
      value_type: TEXT
      params: |
        var Nutanix = {
        	params: {},

        	setParams: function (requiredParams, allParams) {
        		requiredParams.forEach(function (field) {
        			if (typeof allParams !== 'object' || typeof allParams[field] === 'undefined' || allParams[field] === '') {
        				throw 'Required param is not set: ' + field + '.';
        			}
        		});

        		Nutanix.params = params;
        	},

        	request: function (url) {

        		var request = new HttpRequest();

        		if (typeof Nutanix.params.proxy !== 'undefined' && Nutanix.params.proxy !== '') {
        			request.setProxy(Nutanix.params.proxy);
        		}

        		request.setHttpAuth(HTTPAUTH_BASIC, Nutanix.params.username, Nutanix.params.password);

        		Zabbix.log(4, '[ Nutanix ] Sending request: ' + url);

        		const response = request.get(url);

        		Zabbix.log(4, '[ Nutanix ] Received response with status code ' + request.getStatus() + ': ' + response);

        		if (request.getStatus() < 200 || request.getStatus() >= 300) {
        			throw 'Request failed with status code ' + request.getStatus() + ': ' + response;
        		}

        		try {
        			response = JSON.parse(response);
        		}
        		catch (error) {
        			throw 'Failed to parse response received from Nutanix PRISM API. Check debug log for more information.';
        		}

        		return response;
        	},

        	deduplicateAlerts: function (full_data) {
        		const severity_mapping = [
        			'kinfo',
        			'kwarning',
        			'kcritical'
        		]

        		var output_data = {};
        		for (var entity in full_data.entities) {
        	
        			if (Nutanix.params.api_method === 'clusters') {
        				if (result.entities[entity].node_uuid.split('-').length == 5) continue;
        			}

        			var severity = severity_mapping.indexOf(full_data.entities[entity].severity.toLowerCase()),
        				message = full_data.entities[entity].message,
        				title = full_data.entities[entity].alert_title;
        	
        			full_data.entities[entity].context_types.forEach(function(context, index) {
        				message = message.replace('{' + context + '}', full_data.entities[entity].context_values[index]);
        				title = title.replace('{' + context + '}', full_data.entities[entity].context_values[index]);
        			});
        	
        			key = md5(title + message);
        			if (key in output_data) {
        				if (full_data.entities[entity].created_time_stamp_in_usecs > output_data[key].created) {
        					output_data[key].created = full_data.entities[entity].created_time_stamp_in_usecs;
        					output_data[key].severity = severity !== -1 ? severity : 3;
        					output_data[key].state = full_data.entities[entity].resolved ? 0 : 1;
        					output_data[key].message = full_data.entities[entity].detailed_message != '' ? full_data.entities[entity].detailed_message : message;
        					output_data[key].last_id = full_data.entities[entity].id;
        				}
        				output_data[key].count += 1;
        			} else {
        				output_data[key] = {
        					"name": title + ' - ' + message,
        					"title": title != '' ? title : message,
        					"created": full_data.entities[entity].created_time_stamp_in_usecs,
        					"severity": severity !== -1 ? severity : 3,
        					"state": full_data.entities[entity].resolved ? 0 : 1,
        					"message": full_data.entities[entity].detailed_message != '' ? full_data.entities[entity].detailed_message : message,
        					"last_id": full_data.entities[entity].id,
        					"count": 1
        				}
        			}
        		}

        		return output_data;
        	},

        	cleanUnsupported: function (full_stat) {
        		var output_stat = {};
        		for (var element in full_stat) {
        			if (full_stat[element] !== '-1') {
        				output_stat[element] = full_stat[element];
        			}
        		};
        		
        		return output_stat;
        	}
        };

        try {
        	const params = JSON.parse(value);
        	Nutanix.setParams(['endpoint_host', 'endpoint_port', 'username', 'password', 'auth_type', 'api_method', 'target_uuid'], params);

        	const url = 'https://' + Nutanix.params.endpoint_host + ':' + Nutanix.params.endpoint_port + '/PrismGateway/services/rest/v2.0/' + Nutanix.params.api_method + '/' + Nutanix.params.target_uuid + '/alerts',
        		result = Nutanix.request(url);

        	return JSON.stringify(Nutanix.deduplicateAlerts(result));
        }
        catch (error) {
        	error += (String(error).endsWith('.')) ? '' : '.';
        	Zabbix.log(4, '[ Nutanix ] ERROR: ' + error);

        	return JSON.stringify({ 'error': error });
        }
      description: Get data about alerts.
      timeout: '{$NUTANIX.TIMEOUT}'
      parameters:
      - name: api_method
        value: clusters
      - name: auth_type
        value: basic
      - name: endpoint_host
        value: '{$NUTANIX.PRISM.ELEMENT.IP}'
      - name: endpoint_port
        value: '{$NUTANIX.PRISM.ELEMENT.PORT}'
      - name: password
        value: '{$NUTANIX.PASSWORD}'
      - name: proxy
        value: '{$NUTANIX.PROXY}'
      - name: target_uuid
        value: '{$NUTANIX.CLUSTER.UUID}'
      - name: username
        value: '{$NUTANIX.USER}'
      tags:
      - tag: component
        value: raw
    - uuid: 1dc2ba69aa5440d8830313157499179e
      name: Get alert check
      type: DEPENDENT
      key: nutanix.cluster.alert.get.check
      value_type: TEXT
      description: Data collection check. Check the latest values for details.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.error
        error_handler: CUSTOM_VALUE
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 3h
      master_item:
        key: nutanix.cluster.alert.get
      tags:
      - tag: component
        value: status
      triggers:
      - uuid: 741e1271a7454b9ab0214ae39b04f9cb
        expression: length(last(/Nutanix Cluster Prism Element by HTTP/nutanix.cluster.alert.get.check))>0
        name: 'Nutanix: Failed to get alert data from the API'
        priority: HIGH
        description: Failed to get data from the API. Check the latest values for
          details.
        tags:
        - tag: scope
          value: availability
    - uuid: 5567209755544223bf83e977ec209eaa
      name: 'General: Cluster operation mode'
      type: DEPENDENT
      key: nutanix.cluster.cluster.operation.mode
      description: |
        The cluster operation mode. One of the following:
        - NORMAL;
        - OVERRIDE;
        - READONLY;
        - STANDALONE;
        - SWITCH_TO_TWO_NODE;
        - UNKNOWN.
      valuemap:
        name: 'Nutanix: Cluster operation mode'
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.operation_mode
        error_handler: DISCARD_VALUE
      - type: JAVASCRIPT
        parameters:
        - |
          const idx = [
            'NORMAL',
            'OVERRIDE',
            'READONLY',
            'STANDALONE',
            'SWITCH_TO_TWO_NODE'
          ].indexOf(value.toUpperCase());
          return idx !== -1 ? idx : 5;
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 1h
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: c11c24fa7c7047f5ba5f7f39bccb656e
      name: 'Content Cache: References'
      type: DEPENDENT
      key: nutanix.cluster.content.cache.dedup.ref.num
      description: Average number of content cache references.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.content_cache_num_dedup_ref_count_pph
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: e1696a8e6028406e8e9005ebc295a4fa
      name: 'Content Cache: Hit rate, %'
      type: DEPENDENT
      key: nutanix.cluster.content.cache.hit.percent
      value_type: FLOAT
      units: '%'
      description: Content cache hits over all lookups.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.content_cache_hit_ppm
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '0.0001'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: fc40402b8e51471fb3299796c62a9669
      name: 'Content Cache: Logical memory usage, bytes'
      type: DEPENDENT
      key: nutanix.cluster.content.cache.logical.memory.usage.bytes
      units: B
      description: Logical memory used to cache data without deduplication in bytes.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.content_cache_logical_memory_usage_bytes
        error_handler: DISCARD_VALUE
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 1h
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
      - tag: component
        value: memory
    - uuid: 24b35405698e4e4d95ef2be9c5d0d44f
      name: 'Content Cache: Logical SSD usage, bytes'
      type: DEPENDENT
      key: nutanix.cluster.content.cache.logical.ssd.usage.bytes
      units: B
      description: Logical SSD memory used to cache data without deduplication in
        bytes.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.content_cache_logical_ssd_usage_bytes
        error_handler: DISCARD_VALUE
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 1h
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
      - tag: component
        value: memory
    - uuid: 91b14b7aec844e38805b003b89059304
      name: 'Content Cache: Number of lookups'
      type: DEPENDENT
      key: nutanix.cluster.content.cache.lookups.num
      description: Number of lookups on the content cache.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.content_cache_num_lookups
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 95f4f380b95945d182fd99053477b592
      name: 'Content Cache: Physical memory usage, bytes'
      type: DEPENDENT
      key: nutanix.cluster.content.cache.physical.memory.usage.bytes
      units: B
      description: Real memory used to cache data via the content cache in bytes.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.content_cache_physical_memory_usage_bytes
        error_handler: DISCARD_VALUE
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 1h
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
      - tag: component
        value: memory
    - uuid: f2ecb476122e4289972b3132178c969e
      name: 'Content Cache: Physical SSD usage, bytes'
      type: DEPENDENT
      key: nutanix.cluster.content.cache.physical.ssd.usage.bytes
      units: B
      description: Real SSD usage used to cache data via the content cache in bytes.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.content_cache_physical_ssd_usage_bytes
        error_handler: DISCARD_VALUE
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 1h
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
      - tag: component
        value: memory
    - uuid: aa48c01e28d840e6a2bb87b892835f48
      name: 'Content Cache: Logical saved memory usage, bytes'
      type: DEPENDENT
      key: nutanix.cluster.content.cache.saved.memory.usage.bytes
      units: B
      description: Memory saved due to content cache deduplication in bytes.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.content_cache_saved_memory_usage_bytes
        error_handler: DISCARD_VALUE
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 1h
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
      - tag: component
        value: memory
    - uuid: 894a313d9eb5409ba7c198c62cf7d9f9
      name: 'Content Cache: Saved SSD usage, bytes'
      type: DEPENDENT
      key: nutanix.cluster.content.cache.saved.ssd.usage.bytes
      units: B
      description: SSD usage saved due to content cache deduplication in bytes.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.content_cache_saved_ssd_usage_bytes
        error_handler: DISCARD_VALUE
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 1h
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
      - tag: component
        value: memory
    - uuid: c107dffc846940f2b32e1d7d01a22cb6
      name: 'Controller: Random IO'
      type: DEPENDENT
      key: nutanix.cluster.controller.io.random
      description: The number of random Input/Output operations from the controller.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_num_random_io
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: eea230e867044336a10f8308f05b5c32
      name: 'Controller: Random IO, %'
      type: DEPENDENT
      key: nutanix.cluster.controller.io.random.percent
      value_type: FLOAT
      units: '%'
      description: The percentage of random Input/Output from the controller.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_random_io_ppm
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '0.0001'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: ef919d4e2bff4cbc94bd59be2cfb50f4
      name: 'Controller: Sequence IO'
      type: DEPENDENT
      key: nutanix.cluster.controller.io.sequence
      description: The number of sequential Input/Output operations from the controller.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_num_seq_io
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 058564b6e59f470c9ef74a9d6b68d8d9
      name: 'Controller: Sequence IO, %'
      type: DEPENDENT
      key: nutanix.cluster.controller.io.sequence.percent
      value_type: FLOAT
      units: '%'
      description: The percentage of sequential Input/Output from the controller.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_seq_io_ppm
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '0.0001'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: f9a5a272fad04acb8d5fc1d806e01d60
      name: 'General: IO'
      type: DEPENDENT
      key: nutanix.cluster.general.io
      description: The number of Input/Output operations from the disk.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.num_io
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 642236ff71de4ead98e8f738e8524694
      name: 'General: IO, bandwidth'
      type: DEPENDENT
      key: nutanix.cluster.general.io.bandwidth
      units: Bps
      description: Data transferred in B/sec from the disk.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.io_bandwidth_kBps
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1024'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: bedecc8f97b74f7287a4a094fe26cfe7
      name: 'General: IO, latency'
      type: DEPENDENT
      key: nutanix.cluster.general.io.latency
      value_type: FLOAT
      units: s
      description: Input/Output latency from the disk.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.avg_io_latency_usecs
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1.0E-6'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: ee2c4b096f0f4ac1b60b6441094fe076
      name: 'General: Random IO'
      type: DEPENDENT
      key: nutanix.cluster.general.io.random
      description: The number of random Input/Output operations.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.num_random_io
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: c03b24dc56ae4c23a82578479ae2eb6d
      name: 'General: Random IO, %'
      type: DEPENDENT
      key: nutanix.cluster.general.io.random.percent
      value_type: FLOAT
      units: '%'
      description: The percentage of random Input/Output operations.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.random_io_ppm
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '0.0001'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 78e01fe5d2dd4f07b9ee34b49fac9ca4
      name: 'General: Read IO'
      type: DEPENDENT
      key: nutanix.cluster.general.io.read
      description: Total number of Input/Output read operations.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.num_read_io
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 6fb8985279ff4aeb932270322a4e41f6
      name: 'General: Read IO, bandwidth'
      type: DEPENDENT
      key: nutanix.cluster.general.io.read.bandwidth
      units: Bps
      description: Read data transferred in B/sec from the disk.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.read_io_bandwidth_kBps
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1024'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: a6fcbeca6b1648659e0e74225d40863a
      name: 'General: Read IO, latency'
      type: DEPENDENT
      key: nutanix.cluster.general.io.read.latency
      value_type: FLOAT
      units: s
      description: Average Input/Output read latency.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.avg_read_io_latency_usecs
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1.0E-6'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: d2b762b0b9b74e8a8e8a8e40a3e932cf
      name: 'General: Read IO, %'
      type: DEPENDENT
      key: nutanix.cluster.general.io.read.percent
      value_type: FLOAT
      units: '%'
      description: The total percentage of Input/Output operations that are reads.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.read_io_ppm
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '0.0001'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: ba49928014e64b8d8f90dbc76c2b6b57
      name: 'General: IO total read, bytes'
      type: DEPENDENT
      key: nutanix.cluster.general.io.read.total.bytes
      units: B
      description: Total size of Input/Output read operations.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.total_read_io_size_kbytes
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1024'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 30a67ff848484e4e9552a1bcd66c1f68
      name: 'General: IO total read, sec'
      type: DEPENDENT
      key: nutanix.cluster.general.io.read.total.sec
      value_type: FLOAT
      units: s
      description: Total time of Input/Output read operations.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.total_read_io_time_usecs
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1.0E-6'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 9ce271586ac249d2b2fa27fa9b3e3878
      name: 'General: Sequence IO'
      type: DEPENDENT
      key: nutanix.cluster.general.io.sequence
      description: The number of sequential Input/Output operations.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.num_seq_io
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 97990e2fb53b464cadc13d0038f21199
      name: 'General: Sequence IO, %'
      type: DEPENDENT
      key: nutanix.cluster.general.io.sequence.percent
      value_type: FLOAT
      units: '%'
      description: The percentage of sequential Input/Output.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.seq_io_ppm
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '0.0001'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: a01ae646308045d3b88d8e917000018c
      name: 'General: IO total, bytes'
      type: DEPENDENT
      key: nutanix.cluster.general.io.total.bytes
      units: B
      description: Total size of Input/Output operations.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.total_io_size_kbytes
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1024'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 108356c5fd5c49c79840b7a6d9de8659
      name: 'General: IO total, sec'
      type: DEPENDENT
      key: nutanix.cluster.general.io.total.sec
      value_type: FLOAT
      units: s
      description: Total time of Input/Output operations.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.total_io_time_usecs
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1.0E-6'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: f9b61618e2e545ac9e859d101bc10651
      name: 'General: Write IO'
      type: DEPENDENT
      key: nutanix.cluster.general.io.write
      description: Input/Output write operations from the disk.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.num_write_io
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 86dea3be95e44cac9b4a7ab8b5105681
      name: 'General: Write IO, bandwidth'
      type: DEPENDENT
      key: nutanix.cluster.general.io.write.bandwidth
      units: Bps
      description: Write data transferred in B/sec from the disk.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.write_io_bandwidth_kBps
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1024'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 700b81f909c1471eb2fc0611e74876f3
      name: 'General: Write IO, latency'
      type: DEPENDENT
      key: nutanix.cluster.general.io.write.latency
      value_type: FLOAT
      units: s
      description: Average Input/Output write operation latency.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.avg_write_io_latency_usecs
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1.0E-6'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 41950b93ee44469c8589bb5c0f8c0911
      name: 'General: Write IO, %'
      type: DEPENDENT
      key: nutanix.cluster.general.io.write.percent
      value_type: FLOAT
      units: '%'
      description: Total percentage of Input/Output operations that are writes.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.write_io_ppm
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '0.0001'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 4aedd6caaa014e42a7bacac34e9809ac
      name: 'General: IOPS'
      type: DEPENDENT
      key: nutanix.cluster.general.iops
      units: '!iops'
      description: Input/Output operations per second from the disk.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.num_iops
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: c9e26c8d0e2f44089a9591769ab2eceb
      name: 'General: Read IOPS'
      type: DEPENDENT
      key: nutanix.cluster.general.iops.read
      units: '!iops'
      description: Input/Output read operations per second from the disk.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.num_read_iops
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 96182d97edac497883185899cd978f26
      name: 'General: Write IOPS'
      type: DEPENDENT
      key: nutanix.cluster.general.iops.write
      value_type: FLOAT
      units: '!iops'
      description: Total number of Input/Output write operations per second.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.num_write_iops
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: f9433014206a42d3aecf207448f6dee0
      name: 'General: Storage capacity, bytes'
      type: DEPENDENT
      key: nutanix.cluster.general.storage.capacity.bytes
      units: B
      description: Total size of the datastores used by this system in bytes.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.usage_stats.['storage.capacity_bytes']
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 1h
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: 702544e35ca1490cb401d7730df044fd
      name: 'General: Storage free, bytes'
      type: DEPENDENT
      key: nutanix.cluster.general.storage.free.bytes
      units: B
      description: Total free space of the datastores used by this system in bytes.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.usage_stats.['storage.free_bytes']
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 1h
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: 87a495b3a7e246e187d034166ec9e19d
      name: 'General: Storage logical usage, bytes'
      type: DEPENDENT
      key: nutanix.cluster.general.storage.logical.usage.bytes
      units: B
      description: Total logical space used by the datastores of this system in bytes.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.usage_stats.['storage.logical_usage_bytes']
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 1h
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: 02809b0e347d49eeb1f8a8deac32af86
      name: 'General: Storage usage, bytes'
      type: DEPENDENT
      key: nutanix.cluster.general.storage.usage.bytes
      units: B
      description: Total physical datastore space used by this host and all its snapshots
        on the datastores.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.usage_stats.['storage.usage_bytes']
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 1h
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: 4df3faff926b4d92bffd46949e6443bf
      name: 'General: Timespan, sec'
      type: DEPENDENT
      key: nutanix.cluster.general.timespan.sec
      value_type: FLOAT
      units: s
      description: Cluster timespan.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.timespan_usecs
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1.0E-6'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 9b9d93d4a09c45d2bd61a530f5e35fe9
      name: 'General: Total transformed usage, bytes'
      type: DEPENDENT
      key: nutanix.cluster.general.transformed.usage.total.bytes
      units: B
      description: Actual usage of storage.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.total_transformed_usage_bytes
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 1d7c83bbf00149b2a37c1f983d44f403
      name: 'General: Total untransformed usage, bytes'
      type: DEPENDENT
      key: nutanix.cluster.general.untransformed.usage.total.bytes
      units: B
      description: Logical usage of storage (physical usage divided by the replication
        factor).
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.total_untransformed_usage_bytes
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 252f167e9e7d4db1abcfa9808a0c06d9
      name: 'General: Upgrade progress'
      type: DEPENDENT
      key: nutanix.cluster.general.upgrade.progress
      description: Indicates whether the cluster is currently in an update state.
      valuemap:
        name: 'Nutanix: Boolean'
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.is_upgrade_in_progress
        error_handler: DISCARD_VALUE
      - type: BOOL_TO_DECIMAL
        error_handler: CUSTOM_VALUE
        error_handler_params: '2'
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 1h
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 400a5d3e0f1c47cd881c1dfe04b65948
      name: 'General: Version'
      type: DEPENDENT
      key: nutanix.cluster.general.upgrade.version
      value_type: CHAR
      description: Current software version in the cluster.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.version
        error_handler: DISCARD_VALUE
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 12h
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 4f03001a7caa42d29cc2213137fbbb16
      name: 'Hypervisor: CPU usage, %'
      type: DEPENDENT
      key: nutanix.cluster.hypervisor.cpu.usage.percent
      value_type: FLOAT
      units: '%'
      description: Percentage of CPU used by the Hypervisor.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.hypervisor_cpu_usage_ppm
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '0.0001'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: cpu
    - uuid: a5338864811a4e5795ead521cbcf875e
      name: 'Hypervisor: IO'
      type: DEPENDENT
      key: nutanix.cluster.hypervisor.io
      value_type: FLOAT
      description: The number of Input/Output operations from the Hypervisor.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.hypervisor_num_io
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 1f56c2405992402e8897cde88f36284e
      name: 'Hypervisor: IO, bandwidth'
      type: DEPENDENT
      key: nutanix.cluster.hypervisor.io.bandwidth
      units: Bps
      description: Data transferred in B/sec from the Hypervisor.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.hypervisor_io_bandwidth_kBps
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1024'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: f4a46c9187584d88a256eb364884303f
      name: 'Hypervisor: IO, latency'
      type: DEPENDENT
      key: nutanix.cluster.hypervisor.io.latency
      value_type: FLOAT
      units: s
      description: Input/Output operation latency from the Hypervisor.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.hypervisor_avg_io_latency_usecs
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1.0E-6'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 58fe88d634a045f0ba0259ea2e55e757
      name: 'Hypervisor: Read IO'
      type: DEPENDENT
      key: nutanix.cluster.hypervisor.io.read
      description: The number of Input/Output read operations from the Hypervisor.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.hypervisor_num_read_io
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: cbf141d09f7347b2b3fdb16ccd6e172c
      name: 'Hypervisor: Read IO, bandwidth'
      type: DEPENDENT
      key: nutanix.cluster.hypervisor.io.read.bandwidth
      units: Bps
      description: Read data transferred in B/sec from the Hypervisor.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.hypervisor_read_io_bandwidth_kBps
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1024'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 8e163e2751cb43a098a0cbfb6405c1d3
      name: 'Hypervisor: Read IO, latency'
      type: DEPENDENT
      key: nutanix.cluster.hypervisor.io.read.latency
      value_type: FLOAT
      units: s
      description: Input/Output read latency from the Hypervisor.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.hypervisor_avg_read_io_latency_usecs
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1.0E-6'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 7b43893117524aaf823baafa3dd42e0a
      name: 'Hypervisor: IO total read, bytes'
      type: DEPENDENT
      key: nutanix.cluster.hypervisor.io.read.total.bytes
      units: B
      description: Total Input/Output read operation size from the Hypervisor.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.hypervisor_total_read_io_size_kbytes
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1024'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: e60bc882d8024ca59b9b6719be60fb65
      name: 'Hypervisor: IO total read, sec'
      type: DEPENDENT
      key: nutanix.cluster.hypervisor.io.read.total.sec
      value_type: FLOAT
      units: s
      description: Total Input/Output read operation time from the Hypervisor.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.hypervisor_total_read_io_time_usecs
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1.0E-6'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 91517ef954de4a0892bac9091b0ac09a
      name: 'Hypervisor: IO total, bytes'
      type: DEPENDENT
      key: nutanix.cluster.hypervisor.io.total.bytes
      units: B
      description: Total Input/Output operation size from the Hypervisor.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.hypervisor_total_io_size_kbytes
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1024'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: dcc89d2d7d2e4d0c9c46b369af90b17a
      name: 'Hypervisor: IO total, sec'
      type: DEPENDENT
      key: nutanix.cluster.hypervisor.io.total.sec
      value_type: FLOAT
      units: s
      description: Total Input/Output operation time from the Hypervisor.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.hypervisor_total_io_time_usecs
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1.0E-6'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: ee50c946b2a9490fafc2c25abd7c39e1
      name: 'Hypervisor: Write IO'
      type: DEPENDENT
      key: nutanix.cluster.hypervisor.io.write
      description: Input/Output write operations from the Hypervisor.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.hypervisor_num_write_io
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 13a6557f9bce4e5094d35537da7c48a7
      name: 'Hypervisor: Write IO, bandwidth'
      type: DEPENDENT
      key: nutanix.cluster.hypervisor.io.write.bandwidth
      units: Bps
      description: Write data transferred in B/sec from the Hypervisor.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.hypervisor_write_io_bandwidth_kBps
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1024'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: a161c827020740e28edf2c223f1c498b
      name: 'Hypervisor: Write IO, latency'
      type: DEPENDENT
      key: nutanix.cluster.hypervisor.io.write.latency
      value_type: FLOAT
      units: s
      description: Input/Output write latency from the Hypervisor.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.hypervisor_avg_write_io_latency_usecs
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1.0E-6'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: e51fd2cd48a441d1a5699581ccab53fb
      name: 'Hypervisor: IOPS'
      type: DEPENDENT
      key: nutanix.cluster.hypervisor.iops
      units: '!iops'
      description: Input/Output operations per second from the Hypervisor.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.hypervisor_num_iops
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 01241090d9f743d9bf8532c950506a2a
      name: 'Hypervisor: Read IOPS'
      type: DEPENDENT
      key: nutanix.cluster.hypervisor.iops.read
      description: Input/Output read operations per second from the Hypervisor.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.hypervisor_num_read_iops
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: c85d41ca89f2438fb9b4c06da9ae0bc7
      name: 'Hypervisor: Write IOPS'
      type: DEPENDENT
      key: nutanix.cluster.hypervisor.iops.write
      units: '!iops'
      description: Input/Output write operations per second from the Hypervisor.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.hypervisor_num_write_iops
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 6c7717cbf8f44c0dbc69f6b4bd845d65
      name: 'Hypervisor: Memory usage, %'
      type: DEPENDENT
      key: nutanix.cluster.hypervisor.memory.usage.percent
      value_type: FLOAT
      units: '%'
      description: Percentage of memory used by the Hypervisor.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.hypervisor_memory_usage_ppm
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '0.0001'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: memory
    - uuid: 41f4cfc6eb7746799e4bb05306527995
      name: 'Hypervisor: Timespan, sec'
      type: DEPENDENT
      key: nutanix.cluster.hypervisor.timespan.sec
      value_type: FLOAT
      units: s
      description: Hypervisor timespan.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.hypervisor_timespan_usecs
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1.0E-6'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: 95a5fd893da84a7098cba12ffa1743ca
      name: Get metric
      type: SCRIPT
      key: nutanix.cluster.metric.get
      history: '0'
      value_type: TEXT
      params: |
        var Nutanix = {
        	params: {},

        	setParams: function (requiredParams, allParams) {
        		requiredParams.forEach(function (field) {
        			if (typeof allParams !== 'object' || typeof allParams[field] === 'undefined' || allParams[field] === '') {
        				throw 'Required param is not set: ' + field + '.';
        			}
        		});

        		Nutanix.params = params;
        	},

        	request: function (url) {

        		var request = new HttpRequest();

        		if (typeof Nutanix.params.proxy !== 'undefined' && Nutanix.params.proxy !== '') {
        			request.setProxy(Nutanix.params.proxy);
        		}

        		request.setHttpAuth(HTTPAUTH_BASIC, Nutanix.params.username, Nutanix.params.password);

        		Zabbix.log(4, '[ Nutanix ] Sending request: ' + url);

        		const response = request.get(url);

        		Zabbix.log(4, '[ Nutanix ] Received response with status code ' + request.getStatus() + ': ' + response);

        		if (request.getStatus() < 200 || request.getStatus() >= 300) {
        			throw 'Request failed with status code ' + request.getStatus() + ': ' + response;
        		}

        		try {
        			response = JSON.parse(response);
        		}
        		catch (error) {
        			throw 'Failed to parse response received from Nutanix PRISM API. Check debug log for more information.';
        		}

        		return response;
        	},

        	deduplicateAlerts: function (full_data) {
        		const severity_mapping = [
        			'kinfo',
        			'kwarning',
        			'kcritical'
        		]

        		var output_data = {};
        		for (var entity in full_data.entities) {
        	
        			if (Nutanix.params.api_method === 'clusters') {
        				if (result.entities[entity].node_uuid.split('-').length == 5) continue;
        			}

        			var severity = severity_mapping.indexOf(full_data.entities[entity].severity.toLowerCase()),
        				message = full_data.entities[entity].message,
        				title = full_data.entities[entity].alert_title;
        	
        			full_data.entities[entity].context_types.forEach(function(context, index) {
        				message = message.replace('{' + context + '}', full_data.entities[entity].context_values[index]);
        				title = title.replace('{' + context + '}', full_data.entities[entity].context_values[index]);
        			});
        	
        			key = md5(title + message);
        			if (key in output_data) {
        				if (full_data.entities[entity].created_time_stamp_in_usecs > output_data[key].created) {
        					output_data[key].created = full_data.entities[entity].created_time_stamp_in_usecs;
        					output_data[key].severity = severity !== -1 ? severity : 3;
        					output_data[key].state = full_data.entities[entity].resolved ? 0 : 1;
        					output_data[key].message = full_data.entities[entity].detailed_message != '' ? full_data.entities[entity].detailed_message : message;
        					output_data[key].last_id = full_data.entities[entity].id;
        				}
        				output_data[key].count += 1;
        			} else {
        				output_data[key] = {
        					"name": title + ' - ' + message,
        					"title": title != '' ? title : message,
        					"created": full_data.entities[entity].created_time_stamp_in_usecs,
        					"severity": severity !== -1 ? severity : 3,
        					"state": full_data.entities[entity].resolved ? 0 : 1,
        					"message": full_data.entities[entity].detailed_message != '' ? full_data.entities[entity].detailed_message : message,
        					"last_id": full_data.entities[entity].id,
        					"count": 1
        				}
        			}
        		}

        		return output_data;
        	},

        	cleanUnsupported: function (full_stat) {
        		var output_stat = {};
        		for (var element in full_stat) {
        			if (full_stat[element] !== '-1') {
        				output_stat[element] = full_stat[element];
        			}
        		};
        		
        		return output_stat;
        	}
        };

        try {
        	const params = JSON.parse(value);
        	Nutanix.setParams(['endpoint_host', 'endpoint_port', 'username', 'password', 'auth_type', 'api_method', 'target_uuid'], params);

        	const url = 'https://' + Nutanix.params.endpoint_host + ':' + Nutanix.params.endpoint_port + '/PrismGateway/services/rest/v2.0/' + Nutanix.params.api_method + '/' + Nutanix.params.target_uuid;
        	var result = Nutanix.request(url);

        	result.stats = Nutanix.cleanUnsupported(result.stats);

        	return JSON.stringify(result);
        }
        catch (error) {
        	error += (String(error).endsWith('.')) ? '' : '.';
        	Zabbix.log(4, '[ Nutanix ] ERROR: ' + error);

        	return JSON.stringify({ 'error': error });
        }
      description: Get data about basic metrics.
      timeout: '{$NUTANIX.TIMEOUT}'
      parameters:
      - name: api_method
        value: clusters
      - name: auth_type
        value: basic
      - name: endpoint_host
        value: '{$NUTANIX.PRISM.ELEMENT.IP}'
      - name: endpoint_port
        value: '{$NUTANIX.PRISM.ELEMENT.PORT}'
      - name: password
        value: '{$NUTANIX.PASSWORD}'
      - name: proxy
        value: '{$NUTANIX.PROXY}'
      - name: target_uuid
        value: '{$NUTANIX.CLUSTER.UUID}'
      - name: username
        value: '{$NUTANIX.USER}'
      tags:
      - tag: component
        value: raw
    - uuid: e8f1b3e3920b46cfa96ff0602fb30e6b
      name: Get metric check
      type: DEPENDENT
      key: nutanix.cluster.metric.get.check
      value_type: TEXT
      description: Data collection check. Check the latest values for details.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.error
        error_handler: CUSTOM_VALUE
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 3h
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: status
      triggers:
      - uuid: 5ac8ddec162b4668b1df1493216792d6
        expression: length(last(/Nutanix Cluster Prism Element by HTTP/nutanix.cluster.metric.get.check))>0
        name: 'Nutanix: Failed to get metric data from the API'
        priority: HIGH
        description: Failed to get data from the API. Check the latest values for
          details.
        tags:
        - tag: scope
          value: availability
    - uuid: fc9cc5b7999241e4ae0e097826633569
      name: 'General: Current redundancy factor'
      type: DEPENDENT
      key: nutanix.cluster.redundancy.factor.current
      description: Current value of the redundancy factor on the cluster.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.cluster_redundancy_state.current_redundancy_factor
        error_handler: DISCARD_VALUE
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 1h
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: df508a0e13a843e492d32ffd36eb99e8
      name: 'General: Desired redundancy factor'
      type: DEPENDENT
      key: nutanix.cluster.redundancy.factor.desired
      description: The desired value of the redundancy factor on the cluster.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.cluster_redundancy_state.desired_redundancy_factor
        error_handler: DISCARD_VALUE
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 1h
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: application
    - uuid: b6c6cc1e1a62485fb5b4a1ea3c0b0c4b
      name: 'Storage Controller: IO'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.io
      description: Input/Output operations from the Storage Controller.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_num_io
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: 2146014b3f00416ab56149329ebf1ca3
      name: 'Storage Controller: IO, bandwidth'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.io.bandwidth
      units: Bps
      description: Data transferred in B/sec from the Storage Controller.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_io_bandwidth_kBps
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1024'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: 6538913d53aa4c0da0b882a42b73faa0
      name: 'Storage Controller: IO, latency'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.io.latency
      value_type: FLOAT
      units: s
      description: Input/Output latency from the Storage Controller.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_avg_io_latency_usecs
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1.0E-6'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: 315905ef6b2f497294ccf4702ab5aadf
      name: 'Storage Controller: Read IO'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.io.read
      description: Input/Output read operations from the Storage Controller.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_num_read_io
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: 7871d52184994b799f58e180f7dd89a7
      name: 'Storage Controller: Read IO, bandwidth'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.io.read.bandwidth
      units: Bps
      description: Read data transferred in B/sec from the Storage Controller.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_read_io_bandwidth_kBps
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1024'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: f4709e46e4684dfe95951705a3462e42
      name: 'Storage Controller: Read IO, bytes'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.io.read.bytes
      units: B
      description: Storage controller average read Input/Output in bytes.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_avg_read_io_size_kbytes
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1024'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: 57c98e0c2d8c426d91f02320b140a3b0
      name: 'Storage Controller: Read IO, latency'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.io.read.latency
      value_type: FLOAT
      units: s
      description: Input/Output read latency from the Storage Controller.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_avg_read_io_latency_usecs
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1.0E-6'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: d57e65a31e8047bd83064913b0f0fc96
      name: 'Storage Controller: Read IO, %'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.io.read.percent
      value_type: FLOAT
      units: '%'
      description: Percentage of Input/Output operations from the Storage Controller
        that are reads.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_read_io_ppm
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '0.0001'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: dc7f96ef1c814eb6900bd0bb41405c4f
      name: 'Storage Controller: IO total read, bytes'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.io.read.total.bytes
      units: B
      description: Total controller read Input/Output size.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_total_read_io_size_kbytes
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1024'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: 9084bbeefa514342bc6550b20145ae87
      name: 'Storage Controller: IO total read, sec'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.io.read.total.sec
      value_type: FLOAT
      units: s
      description: Total controller read Input/Output time.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_total_read_io_time_usecs
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1.0E-6'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: cb3d76f22bec49959d17f827e1fda1b5
      name: 'Storage Controller: IO total, bytes'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.io.total.bytes
      units: B
      description: Total controller Input/Output size.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_total_io_size_kbytes
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1024'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: a5716932dcc3468f812c77b28f29bf01
      name: 'Storage Controller: IO total, sec'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.io.total.sec
      units: s
      description: Total controller Input/Output time.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_total_io_time_usecs
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1.0E-6'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: ecde6b6bd4344b819a39b0d3e2d4e3dc
      name: 'Storage Controller: Write IO'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.io.write
      description: Input/Output write operations to the Storage Controller.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_num_write_io
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: 6d973393007a4851a96f1a2208c99ac0
      name: 'Storage Controller: Write IO, bandwidth'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.io.write.bandwidth
      units: Bps
      description: Write data transferred in B/sec to the Storage Controller.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_write_io_bandwidth_kBps
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1024'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: 829dfe75c62c4770acd8889d5e0f8f61
      name: 'Storage Controller: Write IO, bytes'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.io.write.bytes
      units: B
      description: Storage Controller average write Input/Output in bytes.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_avg_write_io_size_kbytes
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1024'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: a940bb2ff5d549f085997200eb1d09e7
      name: 'Storage Controller: Write IO, latency'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.io.write.latency
      value_type: FLOAT
      units: s
      description: Input/Output write latency to the Storage Controller.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_avg_write_io_latency_usecs
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1.0E-6'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: dfda9f9c6f40488e8a47e591a75775de
      name: 'Storage Controller: Write IO, %'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.io.write.percent
      value_type: FLOAT
      units: '%'
      description: Percentage of Input/Output operations to the Storage Controller
        that are writes.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_write_io_ppm
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '0.0001'
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: b4c5601a57d34fd886a508523f297a49
      name: 'Storage Controller: IOPS'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.iops
      units: '!iops'
      description: Input/Output operations per second from the Storage Controller.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_num_iops
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: f963f424f6644d46b109293108a011b2
      name: 'Storage Controller: Read IOPS'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.iops.read
      units: '!iops'
      description: Input/Output read operations per second from the Storage Controller.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_num_read_iops
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: 298dee7b25e044edb4657855b0ec3ae7
      name: 'Storage Controller: Write IOPS'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.iops.write
      units: '!iops'
      description: Input/Output write operations per second to the Storage Controller.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_num_write_iops
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: 3d48b9ed84164fabb18db28be446c933
      name: 'Storage Tier: Das-sata capacity, bytes'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.tier.das_sata.capacity.bytes
      units: B
      description: The total capacity of Das-sata in bytes.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.usage_stats.['storage_tier.das-sata.capacity_bytes']
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 1h
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: b3b933a4a7284d788095f2f98700a75a
      name: 'Storage Tier: Das-sata free, bytes'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.tier.das_sata.free.bytes
      units: B
      description: The free space of Das-sata in bytes.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.usage_stats.['storage_tier.das-sata.free_bytes']
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 1h
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: 81e208fb9c4949919091c18325557fd9
      name: 'Storage Tier: Das-sata usage, bytes'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.tier.das_sata.usage.bytes
      units: B
      description: The used space of Das-sata in bytes.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.usage_stats.['storage_tier.das-sata.usage_bytes']
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 1h
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: 95c826ea031b462ea1e1ae79e3f4966d
      name: 'Storage Tier: SSD capacity, bytes'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.tier.ssd.capacity.bytes
      units: B
      description: The total capacity of SSD in bytes.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.usage_stats.['storage_tier.ssd.capacity_bytes']
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 1h
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: a17766d845a1410b9b4fe20044d79217
      name: 'Storage Tier: SSD free, bytes'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.tier.ssd.free.bytes
      units: B
      description: The free space of SSD in bytes.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.usage_stats.['storage_tier.ssd.free_bytes']
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 1h
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: 9a10e8850e5f419d8e600757598435bf
      name: 'Storage Tier: SSD usage, bytes'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.tier.ssd.usage.bytes
      units: B
      description: The used space of SSD in bytes.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.usage_stats.['storage_tier.ssd.usage_bytes']
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 1h
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: 1d4367a1f30a46818871cd4a105c73dc
      name: 'Storage Controller: Timespan, sec'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.timespan.sec
      value_type: FLOAT
      units: s
      description: Controller timespan.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_timespan_usecs
        error_handler: DISCARD_VALUE
      - type: MULTIPLIER
        parameters:
        - '1.0E-6'
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 1h
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    - uuid: eb510c9fa96947b9a3d83ce6ab87d217
      name: 'Storage Controller: Total transformed usage, bytes'
      type: DEPENDENT
      key: nutanix.cluster.storage.controller.transformed.usage.total.bytes
      units: B
      description: Actual usage of the Storage Controller.
      preprocessing:
      - type: JSONPATH
        parameters:
        - $.stats.controller_total_transformed_usage_bytes
        error_handler: DISCARD_VALUE
      master_item:
        key: nutanix.cluster.metric.get
      tags:
      - tag: component
        value: storage
    discovery_rules:
    - uuid: 7990ed903e40431999d75702d83b2cbb
      name: Alert discovery
      type: DEPENDENT
      key: nutanix.cluster.alert.discovery
      filter:
        evaltype: AND
        conditions:
        - macro: '{#ALERT.NAME}'
          value: '{$NUTANIX.ALERT.DISCOVERY.NAME.MATCHES}'
        - macro: '{#ALERT.NAME}'
          value: '{$NUTANIX.ALERT.DISCOVERY.NAME.NOT_MATCHES}'
          operator: NOT_MATCHES_REGEX
        - macro: '{#ALERT.SEVERITY}'
          value: '{$NUTANIX.ALERT.DISCOVERY.SEVERITY.MATCHES}'
        - macro: '{#ALERT.STATE}'
          value: '{$NUTANIX.ALERT.DISCOVERY.STATE.MATCHES}'
      description: |
        Discovery of all alerts.
        Alerts will be grouped by title. For each alert, in addition to the basic information, the number of activation and last alert ID will be available.
      item_prototypes:
      - uuid: 0bc36bd639ed43548a3d223abecfc9aa
        name: 'Alert [{#ALERT.NAME}]: Count alerts'
        type: DEPENDENT
        key: nutanix.cluster.alert.count["{#ALERT.KEY}"]
        description: The number of times this alert was triggered.
        preprocessing:
        - type: JSONPATH
          parameters:
          - $.{#ALERT.KEY}.count
        - type: DISCARD_UNCHANGED_HEARTBEAT
          parameters:
          - 1h
        master_item:
          key: nutanix.cluster.alert.get
        tags:
        - tag: component
          value: alert
      - uuid: eafc52b6bb6741b1b7ac2b55bfcf5150
        name: 'Alert [{#ALERT.NAME}]: Create datetime'
        type: DEPENDENT
        key: nutanix.cluster.alert.created["{#ALERT.KEY}"]
        units: unixtime
        description: The alert creation date and time.
        preprocessing:
        - type: JSONPATH
          parameters:
          - $.{#ALERT.KEY}.created
        - type: MULTIPLIER
          parameters:
          - '1.0E-6'
        - type: DISCARD_UNCHANGED_HEARTBEAT
          parameters:
          - 1h
        master_item:
          key: nutanix.cluster.alert.get
        tags:
        - tag: component
          value: alert
      - uuid: b5b880f906d24f16a7a6f9eaf301d2f0
        name: 'Alert [{#ALERT.NAME}]: Last alert ID'
        type: DEPENDENT
        key: nutanix.cluster.alert.last_id["{#ALERT.KEY}"]
        value_type: CHAR
        description: Latest ID of the alert.
        preprocessing:
        - type: JSONPATH
          parameters:
          - $.{#ALERT.KEY}.last_id
        - type: DISCARD_UNCHANGED_HEARTBEAT
          parameters:
          - 12h
        master_item:
          key: nutanix.cluster.alert.get
        tags:
        - tag: component
          value: alert
      - uuid: ae18c1bc06ea4a429a753b9c6d989cc0
        name: 'Alert [{#ALERT.NAME}]: Detailed message'
        type: DEPENDENT
        key: nutanix.cluster.alert.message["{#ALERT.KEY}"]
        value_type: TEXT
        description: Detailed information about the current alert.
        preprocessing:
        - type: JSONPATH
          parameters:
          - $.{#ALERT.KEY}.message
        - type: DISCARD_UNCHANGED_HEARTBEAT
          parameters:
          - 12h
        master_item:
          key: nutanix.cluster.alert.get
        tags:
        - tag: component
          value: alert
      - uuid: 6b72da2095154db1b7561a2bedca8b33
        name: 'Alert [{#ALERT.NAME}]: Severity'
        type: DEPENDENT
        key: nutanix.cluster.alert.severity["{#ALERT.KEY}"]
        description: |
          Alert severity. One of the following:
          - Info;
          - Warning;
          - Critical;
          - Unknown.
        valuemap:
          name: 'Nutanix: Alert severity'
        preprocessing:
        - type: JSONPATH
          parameters:
          - $.{#ALERT.KEY}.severity
        - type: DISCARD_UNCHANGED_HEARTBEAT
          parameters:
          - 1h
        master_item:
          key: nutanix.cluster.alert.get
        tags:
        - tag: component
          value: alert
      - uuid: 269d93010a5c453e9361a15827325743
        name: 'Alert [{#ALERT.NAME}]: State'
        type: DEPENDENT
        key: nutanix.cluster.alert.state["{#ALERT.KEY}"]
        description: |
          Alert state. One of the following:
          - OK;
          - Problem.
        valuemap:
          name: 'Nutanix: Alert state'
        preprocessing:
        - type: JSONPATH
          parameters:
          - $.{#ALERT.KEY}.state
        - type: DISCARD_UNCHANGED_HEARTBEAT
          parameters:
          - 1h
        master_item:
          key: nutanix.cluster.alert.get
        tags:
        - tag: component
          value: alert
      - uuid: d9c2ca71d1a041af83a1b4e9d1df46f2
        name: 'Alert [{#ALERT.NAME}]: Full title'
        type: DEPENDENT
        key: nutanix.cluster.alert.title["{#ALERT.KEY}"]
        value_type: TEXT
        description: The full title of the alert.
        preprocessing:
        - type: JSONPATH
          parameters:
          - $.{#ALERT.KEY}.title
        - type: DISCARD_UNCHANGED_HEARTBEAT
          parameters:
          - 12h
        master_item:
          key: nutanix.cluster.alert.get
        tags:
        - tag: component
          value: alert
      master_item:
        key: nutanix.cluster.alert.get
      preprocessing:
      - type: JAVASCRIPT
        parameters:
        - |
          const json_data = JSON.parse(value);
          var output_data = [];

          for (var entity in json_data) {
          	output_data.push({
          		"{#ALERT.KEY}": entity,
          		"{#ALERT.STATE}": json_data[entity].state,
          		"{#ALERT.TITLE}": json_data[entity].title,
          		"{#ALERT.SEVERITY}": json_data[entity].severity,
          		"{#ALERT.NAME}": json_data[entity].name.length > 50 ? json_data[entity].name.substr(0, 50) + '...' : json_data[entity].name
          	});
          }

          return JSON.stringify(output_data);
      - type: DISCARD_UNCHANGED_HEARTBEAT
        parameters:
        - 1h
    tags:
    - tag: class
      value: software
    - tag: target
      value: cluster
    - tag: target
      value: nutanix
    - tag: target
      value: prism-element
    macros:
    - macro: '{$NUTANIX.ALERT.DISCOVERY.NAME.MATCHES}'
      value: .*
      description: Filter of discoverable Nutanix alerts by name.
    - macro: '{$NUTANIX.ALERT.DISCOVERY.NAME.NOT_MATCHES}'
      value: CHANGE_IF_NEEDED
      description: Filter to exclude discovered Nutanix alerts by name.
    - macro: '{$NUTANIX.ALERT.DISCOVERY.SEVERITY.MATCHES}'
      value: .*
      description: Filter to exclude discovered Nutanix alerts by severity. Set all
        possible severities for filtering in the range 0-2. "0" - Info, "1" - Warning,
        "2" - Critical.
    - macro: '{$NUTANIX.ALERT.DISCOVERY.STATE.MATCHES}'
      value: .*
      description: Filter to exclude discovered Nutanix alerts by state. Set "1" for
        filtering only problem alerts or "0" for resolved ones.
    - macro: '{$NUTANIX.CLUSTER.UUID}'
      description: UUID of the cluster.
    - macro: '{$NUTANIX.PASSWORD}'
      type: SECRET_TEXT
      description: Nutanix API password.
    - macro: '{$NUTANIX.PRISM.ELEMENT.IP}'
      value: <Put your IP here>
      description: Set the Nutanix API IP here.
    - macro: '{$NUTANIX.PRISM.ELEMENT.PORT}'
      value: '9440'
      description: Set the Nutanix API port here.
    - macro: '{$NUTANIX.PROXY}'
      description: Sets the HTTP proxy value. If this macro is empty, then no proxy
        is used.
    - macro: '{$NUTANIX.TIMEOUT}'
      value: 10s
      description: API response timeout.
    - macro: '{$NUTANIX.USER}'
      value: <Put your API username here>
      description: Nutanix API username.
    valuemaps:
    - uuid: 86e15b9ab1e04285a8db065fbdf6eedf
      name: 'Nutanix: Alert severity'
      mappings:
      - value: '0'
        newvalue: Info
      - value: '1'
        newvalue: Warning
      - value: '2'
        newvalue: Critical
      - value: '3'
        newvalue: Unknown
    - uuid: 079d797917c64626af20ce86249c2969
      name: 'Nutanix: Alert state'
      mappings:
      - value: '0'
        newvalue: Ok
      - value: '1'
        newvalue: Problem
    - uuid: 10ec1428fba54eeaabc6503361090761
      name: 'Nutanix: Boolean'
      mappings:
      - value: '0'
        newvalue: 'False'
      - value: '1'
        newvalue: 'True'
      - value: '2'
        newvalue: Unknown
    - uuid: 537aaf6158724960a2535913030f0138
      name: 'Nutanix: Cluster operation mode'
      mappings:
      - value: '0'
        newvalue: Normal
      - value: '1'
        newvalue: Override
      - value: '2'
        newvalue: Readonly
      - value: '3'
        newvalue: Standalone
      - value: '4'
        newvalue: Switch to two node
      - value: '5'
        newvalue: Unknown
